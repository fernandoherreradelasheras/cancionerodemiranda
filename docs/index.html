<!doctype html>
<html>
<head>
  <link rel="stylesheet" href="styles.css">
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/1.0.11/pako.min.js"></script>
</head>
<body>
  

<div class="panel-body" style="height: 100vh">
		<div id="selector" style="padding-bottom: 16px;">
			<label for="tonos">Selecciona un tono:</label>
			<select name="tonos" id="tonos">
			</select>
			<button class="generate-pdf">Download PDF</button>
		</div>
    <div id="app" class="panel" style="border: 1px solid lightgray; min-height: 90%; height: 90%"/>
</div>

<script type="module">
    import 'https://editor.verovio.org/javascript/app/verovio-app.js';

		const options = {
    	defaultView: 'responsive', // instead of 'responsive' by default
	    responsiveZoom: 3, // 0-7, default is 3
			enableDocument: true
		}

		const tonos = [ 
			{ "title": "Un imposible me mata", "file": "01_-_Un_imposible_me_mata-music.mei" },
			{ "title": "Querido imposible mio", "file": "02_-_Querido_imposible_mio-music.mei" },
			{ "title": "Amariles yo no puedo", "file": "03_-_Amariles_yo_no_puedo-music.mei" },
			{ "title": "Más merece quien más ama", "file": "04_-_Mas_merece_quien_mas_ama-music.mei" },
			{ "title": "En carroza de cristal", "file": "05_-_En_carroza_de_cristal-music.mei" },
			{ "title": "Ojos, yo no di licencia", "file": "06_-_Ojos_yo_no_di_licencia-music.mei" },
			{ "title": "A dónde corres arroyo", "file": "07_-_A_donde_corres_arroyo-music.mei" },
			{ "title": "Alarma alarma luzeros", "file": "08_-_alarma_alarma_luceros-music.mei" },
			{ "title": "La belleza de Amariles", "file": "09_-_La_belleza_de_Amariles-music.mei" },
			{ "title": "Aquella deidad del tajo", "file": "10_-_Aquella_deidad_del_Tajo-music.mei" },
			{ "title": "Ojos bellos, quién ha visto", "file": "11_-_Ojos_bellos_quien_ha_visto-music.mei" },
			{ "title": "Filis yo por ti me muero", "file": "12_-_Filis_yo_por_ti_me_muero-music.mei" },
			{ "title": "Celebrando esta el Amor", "file": "13_-_Celebrando_esta_el_Amor-music.mei" },
			{ "title": "Triste tortola que en quejas", "file": "14_-_Triste_tortola_que_en_quejas-music.mei" }
		];

    const app = new Verovio.App(document.getElementById("app"), options);

		function loadTono(filename) {
    	fetch("https://raw.githubusercontent.com/fernandoherreradelasheras/cancionerodemiranda/mei/music-transcriptions/" + filename)
				.then(function(response) {
            return response.text();
        })
        .then(function(text) {
            app.loadData(text);
        });
		}

		function addTonos() {
			var select = document.getElementById("tonos"); 
			for (let i = 0; i < tonos.length; i++) {
					const option = document.createElement("option");
					const text = document.createTextNode(tonos[i]["title"]);
					const file = tonos[i]["file"];
					option.setAttribute("value", file);
					option.appendChild(text)
					select.appendChild(option)
			}
			select.addEventListener("change", (event) => {
				loadTono(event.target.value);
			});
		}

		localStorage.removeItem("options");
		addTonos();
		loadTono(tonos[0]["file"]);
</script>
 

</body>
</html>
